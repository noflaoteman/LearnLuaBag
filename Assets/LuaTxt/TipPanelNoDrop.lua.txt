BasePanel:subClass("TipPanelNoDrop")

function TipPanelNoDrop:Init(name)
    self.base.Init(self, name)
    if self.isInitEvent == false then
        self:GetControl("btnClose", "Button").onClick:AddListener(function()
            self:btnCloseClick()
        end)
        self.isInitEvent = true
    end
end


--显示
function TipPanelNoDrop:ShowMe(name)
    self.base.ShowMe(self, name)
end

-- 通过rectTransform显示
function TipPanelNoDrop:ShowPanelByRect(rectTransform,txtInfo,enumData)
    local screenPosition = RectTransformUtility.WorldToScreenPoint(Camera.main, rectTransform.position)
	self:ShowPanelBy(screenPosition,tex)
end

-- 通过screenPosition显示
function TipPanelNoDrop:ShowPanelByScreenPos(screenPosition,txtInfo,enumData)
    self:ShowMe("TipPanelNoDrop")
    local uiPos = Vector2.zero
    local success, uiPos = RectTransformUtility.ScreenPointToLocalPointInRectangle(
        self.panelObj.transform.parent, 
        screenPosition, 
        Camera.main)

    if success then
        self:GetControl("txtDes", "Text").text = txtInfo
        uiPos.y=uiPos.y+25 
        self:SetPos(uiPos)
    end 
end

-- 设置位置，控制Panel不超出边界
function TipPanelNoDrop:SetPos(uiPoint)
    local rightTopUIpoint = Vector2.zero
    local success, rightTopUIpoint = RectTransformUtility.ScreenPointToLocalPointInRectangle(
        self.panelObj.transform.parent,
        Vector2(CS.UnityEngine.Screen.width, CS.UnityEngine.Screen.height),
        Camera.main)

    if not success then
        return
    end

    local screenWidth = rightTopUIpoint.x
    local screenHeight = rightTopUIpoint.y

    local rect = self.panelObj:GetComponent(typeof(CS.UnityEngine.RectTransform))
    local imgHalfWidth = rect.sizeDelta.x / 2
    local imgHalfHeight = rect.sizeDelta.y / 2

    -- 计算新的位置
    local rectLocalPosition = CS.UnityEngine.Vector3(uiPoint.x, uiPoint.y, rect.localPosition.z)

    if rectLocalPosition.x > (screenWidth - imgHalfWidth) then
        rectLocalPosition.x = screenWidth - imgHalfWidth
    end
    if rectLocalPosition.y > (screenHeight - imgHalfHeight) then
        rectLocalPosition.y = screenHeight - imgHalfHeight
    end

    if rectLocalPosition.x < -screenWidth + imgHalfWidth then
        rectLocalPosition.x = -screenWidth + imgHalfWidth
    end
    if rectLocalPosition.y < -screenHeight + imgHalfHeight then
        rectLocalPosition.y = -screenHeight + imgHalfHeight
    end

    -- 设置UI的位置
    self.panelObj.transform.localPosition = rectLocalPosition
end


--关闭提示面板
function TipPanelNoDrop:btnCloseClick()
    self:HideMe()
end

